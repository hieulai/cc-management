<table class="grid-view item-list" summary="Items List">
    <thead>
    <tr class="header">
        <th>Category</th>
		    <th>Item</th>
        <th>Description</th>
        <th class="amount">Estimated Costs</th>
        <th class="amount">Committed Costs</th>
        <th class="amount">Actual Costs</th>
        <th class="margin">Estimated Profit</th>
        <th class="price">Committed Profit</th>
        <th>Actual Profit</th>
    </tr>
    </thead>
    <tbody>
    <%- amount = 0
        margin = 0
        committed_cost = 0
        actual_cost = 0
        committed_profit = 0
        actual_profit = 0
    %>
    <%- template.categories_templates.each do |category_template| %>
      <%- amount+= category_template.items.map(&:amount).sum
          margin+= category_template.items.map(&:margin).sum
          committed_cost+= category_template.items.map(&:committed_cost).sum
          actual_cost+= category_template.items.map(&:actual_cost).sum
          committed_profit+= category_template.items.map(&:committed_profit).sum
          actual_profit+= category_template.items.map(&:actual_profit).sum

      %>
      <%= render :partial => 'tr_category', :locals => {:category_template => category_template}  %>
    <% end %>
    <tr class="total">
        <td colspan=3>
            GRAND TOTAL
        </td>
        <td>$<div class="total-amount"><%= number_to_price(amount) %></div></td>
        <td>$<div><%= number_to_price(committed_cost) %></div></td>
        <td>$<div><%= number_to_price(actual_cost) %></div></td>
        <td>$<div class="total-margin"><%= number_to_price(margin) %></div></td>
        <td>$<div><%= number_to_price(committed_profit) %></div></td>
        <td>$<div><%= number_to_price(actual_profit) %></div></td>
    </tr>
    </tbody>
</table>